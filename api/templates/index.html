<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Синхронизация баз данных</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
</head>

<body class="bg-light">

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">

            <div class="card shadow-sm">
                <div class="card-body">

                    <h1 class="h4 mb-4 text-center">Синхронизация БД</h1>

                    <form hx-post="/diff" hx-target="#diff-container"
                      hx-on="htmx:responseError: handleDiffError(event)">

                        <div class="mb-3">
                            <label class="form-label">База-источник</label>
                            <input
                                type="text"
                                name="source_url"
                                class="form-control"
                                placeholder="postgresql://user:password@host:5432/source_db"
                                required
                            >
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Целевая база данных</label>
                            <input
                                type="text"
                                name="target_url"
                                class="form-control"
                                placeholder="postgresql://user:password@host:5432/target_db"
                                required
                            >
                        </div>

                        <div class="mb-4">
                            <label class="form-label">Стратегия разрешения конфликтов PK</label>
                            <select
                                name="pk_strategy"
                                class="form-select"
                                onchange="
                                  document
                                    .querySelectorAll('.pk-strategy')
                                    .forEach(s => s.value = this.value)
                                "
                            >
                                <option value="skip">Пропускать конфликтующие записи</option>
                                <option value="overwrite">Перезаписывать данные</option>
                                <option value="merge">Объединять данные</option>
                            </select>
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">
                                Показать различия схемы
                            </button>
                        </div>

                    </form>

                </div>
            </div>

            <div id="diff-container" class="mt-4"></div>

        </div>
    </div>
</div>

<script>
function handleDiffError(event) {
    const container = document.querySelector('#diff-container');
    container.innerHTML = `
        <div class="alert alert-danger" role="alert">
            Ошибка при подключении к базе данных.<br>
            Проверьте корректность ссылок и активность серверов БД.
        </div>
    `;
}
</script>

</body>
</html>
